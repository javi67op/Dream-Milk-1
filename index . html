<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DREAM MILK</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Segoe UI, Arial;
  background:#f4f6fa;
}
header{
  background:#0d6efd;
  color:#fff;
  padding:14px;
  text-align:center;
}
nav{
  display:flex;
}
nav button{
  flex:1;
  padding:12px;
  border:none;
  background:#e9ecef;
  font-weight:bold;
}
nav button.active{
  background:#0d6efd;
  color:white;
}
.card{
  background:white;
  margin:12px;
  padding:12px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
}
input,select,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:6px;
  border:1px solid #ccc;
}
button{
  background:#0d6efd;
  color:white;
  border:none;
  font-weight:bold;
}
button.danger{background:#dc3545}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:8px;
  border-bottom:1px solid #ddd;
  text-align:center;
}
.hidden{display:none}

@media print{
  body *{visibility:hidden}
  #printArea, #printArea *{visibility:visible}
  #printArea{position:absolute;top:0;left:0;width:100%}
}
</style>
</head>

<body>

<header>
<h2>ðŸ¥› DREAM MILK</h2>
<small>Farmer & Client Dairy System</small>
</header>

<nav>
<button id="farmerTab" class="active" onclick="show('farmer')">Farmer Page</button>
<button id="clientTab" onclick="show('client')">Client Page</button>
</nav>

<!-- MONTHLY FAT RATE -->
<div class="card">
<h3>Monthly Fat Rate</h3>
<input type="number" id="fatRate" placeholder="Rate per Fat">
<button onclick="saveRate()">Save Rate</button>
</div>

<!-- FARMER PAGE -->
<div id="farmerPage">

<div class="card">
<h3>Add Farmer</h3>
<input id="fName" placeholder="Farmer Name">
<input id="fCode" placeholder="Farmer Code">
<button onclick="addFarmer()">Save Farmer</button>
</div>

<div class="card">
<h3>Farmer Milk Entry</h3>
<input id="fECode" placeholder="Farmer Code">
<select id="fMilk">
<option>Cow</option>
<option>Buffalo</option>
<option>Mix</option>
</select>
<input type="number" id="fLitre" placeholder="Litre">
<input type="number" step="0.1" id="fFat" placeholder="Fat %">
<button onclick="addFarmerEntry()">Save Entry</button>
</div>

<div class="card">
<h3>Farmer Bills</h3>
<table>
<tr><th>Name</th><th>â‚¹ Total</th><th>Print</th><th>Delete</th></tr>
<tbody id="farmerTable"></tbody>
</table>
</div>

</div>

<!-- CLIENT PAGE -->
<div id="clientPage" class="hidden">

<div class="card">
<h3>Add Client</h3>
<input id="cName" placeholder="Client Name">
<input id="cCode" placeholder="Client Code">
<button onclick="addClient()">Save Client</button>
</div>

<div class="card">
<h3>Client Milk Sale</h3>
<input id="cECode" placeholder="Client Code">
<select id="cMilk">
<option>Cow</option>
<option>Buffalo</option>
<option>Mix</option>
</select>
<input type="number" id="cLitre" placeholder="Litre">
<input type="number" step="0.1" id="cFat" placeholder="Fat %">
<button onclick="addClientEntry()">Save Sale</button>
</div>

<div class="card">
<h3>Client Bills</h3>
<table>
<tr><th>Name</th><th>â‚¹ Total</th><th>Print</th><th>Delete</th></tr>
<tbody id="clientTable"></tbody>
</table>
</div>

</div>

<div id="printArea"></div>

<script>
let farmers=JSON.parse(localStorage.farmers||"[]");
let clients=JSON.parse(localStorage.clients||"[]");
let farmerEntries=JSON.parse(localStorage.farmerEntries||"[]");
let clientEntries=JSON.parse(localStorage.clientEntries||"[]");
let rate=localStorage.rate||0;

fatRate.value=rate;

function save(){
localStorage.farmers=JSON.stringify(farmers);
localStorage.clients=JSON.stringify(clients);
localStorage.farmerEntries=JSON.stringify(farmerEntries);
localStorage.clientEntries=JSON.stringify(clientEntries);
localStorage.rate=rate;
render();
}

function saveRate(){
rate=fatRate.value;
save();
alert("Monthly fat rate saved");
}

function show(p){
farmerPage.classList.toggle("hidden",p!=="farmer");
clientPage.classList.toggle("hidden",p!=="client");
farmerTab.classList.toggle("active",p==="farmer");
clientTab.classList.toggle("active",p==="client");
}

function addFarmer(){
farmers.push({name:fName.value,code:fCode.value});
fName.value=fCode.value="";
save();
}

function addClient(){
clients.push({name:cName.value,code:cCode.value});
cName.value=cCode.value="";
save();
}

function addFarmerEntry(){
let amt=fLitre.value*fFat.value*rate;
farmerEntries.push({code:fECode.value,milk:fMilk.value,litre:fLitre.value,fat:fFat.value,amt,date:new Date().toLocaleString()});
save();
}

function addClientEntry(){
let amt=cLitre.value*cFat.value*rate;
clientEntries.push({code:cECode.value,milk:cMilk.value,litre:cLitre.value,fat:cFat.value,amt,date:new Date().toLocaleString()});
save();
}

function total(list,code){
return list.filter(e=>e.code===code).reduce((s,e)=>s+e.amt,0);
}

function printBill(name,code,list){
let rows=list.filter(e=>e.code===code).map(e=>
`<tr><td>${e.date}</td><td>${e.milk}</td><td>${e.litre}</td><td>${e.fat}%</td><td>â‚¹${e.amt}</td></tr>`
).join("");
printArea.innerHTML=`
<h2>DREAM MILK BILL</h2>
<b>${name}</b><br>Code: ${code}
<table border="1" width="100%" cellpadding="6">
<tr><th>Date</th><th>Milk</th><th>Litre</th><th>Fat</th><th>â‚¹</th></tr>
${rows}
</table>
<h3>Total: â‚¹${total(list,code)}</h3>`;
window.print();
}

function render(){
farmerTable.innerHTML="";
farmers.forEach(f=>{
farmerTable.innerHTML+=`
<tr>
<td>${f.name}</td>
<td>â‚¹${total(farmerEntries,f.code)}</td>
<td><button onclick="printBill('${f.name}','${f.code}',farmerEntries)">Print</button></td>
<td><button class="danger" onclick="farmers=farmers.filter(x=>x.code!='${f.code}');save()">X</button></td>
</tr>`;
});

clientTable.innerHTML="";
clients.forEach(c=>{
clientTable.innerHTML+=`
<tr>
<td>${c.name}</td>
<td>â‚¹${total(clientEntries,c.code)}</td>
<td><button onclick="printBill('${c.name}','${c.code}',clientEntries)">Print</button></td>
<td><button class="danger" onclick="clients=clients.filter(x=>x.code!='${c.code}');save()">X</button></td>
</tr>`;
});
}
render();
</script>

</body>
</html>
